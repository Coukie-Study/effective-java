# 가능한 한 실패 원자적으로 만들라
### 실패 원자적이란?
호출된 메서드가 실패하더라도 해당 객체는 메서드 호출 전 상태를 유지하는 특성.

### 메서드를 실패 원자적으로 만드는 방법
- 메서드에 사용되는 매개변수를 불변객체로 만드는 방법
    - 불변객체는 태생적으로 실패 원자적이다.
- 작업 수행에 앞서 매개변수의 유효성을 검사하는 방법
    - 객체의 내부 상태를 변경하기 전에 잠재적 예외의 가능성을 걸러낸다.
    - ````java
      public Object pop(){
          if(size == 0)
              throw new EmptyStackException();
          Object result = elements[--size];
          elements[size] = null; // 다 쓴 참조 해제
          return result;     
      }
      ````
- 위 방식과 비슷한 취지로 실패할 가능성이 있는 모든 코드를, 객체의 상태를 바꾸는 코드보다 앞에 배치하는 방법
    - TreeMap은 원소를 어떤 기준으로 정렬하는데, TreeMap에 원소를 추가하는 과정에서 엉뚱한 객체를 추가하면<br>
    원소가 들어갈 위치를 찾지 못한다. 그러므로 원소가 들어가는 위치를 찾는 작업 전에 ClassCastException을 던진다.
- 객체의 임시 복사본에서 작업을 수행하는 방법
- 작업 도중 발생하는 실패를 가로채는 복구 코드를 작성하여 작업 전 상태로 되돌리는 방법

### 실패 원자성의 유의사항
- 두 스레드가 동기화 없이 같은 객체를 동시에 수정하는경우 객체의 일관성이 깨질 수 있다.
- Error는 복구할 수 없으므로 AssertionError에 대해서는 실패 원자적으로 만들 시도조차 할 필요가 없다.
- 실패 원자성을 달성하기 위해 비용이나 복잡도가 아주 큰 연산이 필요한경우 꼭 만들 필요는 없다.